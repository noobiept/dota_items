var Game;!function(a){var b=function(){function a(){this._listeners={}}return a.prototype.addEventListener=function(a,b){return this._listeners[a]||(this._listeners[a]=[]),Utilities.isFunction(b)&&this._listeners[a].indexOf(b)<0?(this._listeners[a].push(b),!0):!1},a.prototype.removeEventListener=function(a,b){if(this._listeners[a]){if("undefined"==typeof b)return this._listeners[a]=[],!0;var c=this._listeners[a].indexOf(b);if(c>=0)return this._listeners.splice(c,1),!0}return!1},a.prototype.removeAllEventListeners=function(){this._listeners={}},a.prototype.dispatchEvent=function(a,b){var c=this._listeners[a];if(c)for(var d=c.length-1;d>=0;d--)c[d](b)},a.prototype.hasListeners=function(a){return this._listeners[a]&&this._listeners[a].length>0?!0:!1},a}();a.EventDispatcher=b}(Game||(Game={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},Game;!function(a){var b=function(b){function c(a){b.call(this,a);var c=0,d=0;"undefined"!=typeof a&&("undefined"!=typeof a.x&&(c=a.x),"undefined"!=typeof a.y&&(d=a.y)),this.visible=!0,this.x=c,this.y=d,this.width=0,this.height=0,this.opacity=1,this.column=-1,this.line=-1,this._container=null,this._rotation=0,this._has_logic=!1,this._removed=!1}return __extends(c,b),c.prototype.drawElement=function(){throw new Error("Implement .drawElement().")},c.prototype.draw=function(a){this.drawElement(a)},c.prototype.logic=function(){},c.prototype.intersect=function(){throw new Error("Implement .intersect().")},Object.defineProperty(c.prototype,"rotation",{get:function(){return this._rotation},set:function(a){this.rotate(a,!1)},enumerable:!0,configurable:!0}),c.prototype.rotate=function(a,b){this._rotation=b===!0?Math.PI/180*a:a},c.prototype.remove=function(){this._removed=!0,null!==this._container?this._container.removeChild(this):a.removeElement(this)},c.prototype.clone=function(){throw new Error("Implement .clone().")},c}(a.EventDispatcher);a.Element=b}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(a){b.call(this,a),this.image=a.image,this._source_x=0,this._source_y=0}return __extends(c,b),c.prototype.drawElement=function(a){a.save(),a.beginPath(),a.globalAlpha*=this.opacity,a.translate(this.x,this.y),a.rotate(this.rotation),a.drawImage(this._image,this._source_x,this._source_y,this.width,this.height,-this._half_width,-this._half_height,this.width,this.height),a.restore()},c.prototype.intersect=function(a,b,c){var d=0,e=0;return null!==this._container&&(d=this._container.x,e=this._container.y),Utilities.pointBoxCollision(a,b,d+this.x-this._half_width,e+this.y-this._half_height,this.width,this.height)?(this.dispatchEvent(c.type,{event:c}),!0):!1},c.prototype.clone=function(){return new a.Bitmap({x:this.x,y:this.y,image:this._image})},Object.defineProperty(c.prototype,"image",{get:function(){return this._image},set:function(a){this.width=a.width,this.height=a.height,this._half_width=a.width/2,this._half_height=a.height/2,this._image=a},enumerable:!0,configurable:!0}),c}(a.Element);a.Bitmap=b}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(a){b.call(this,a),this._children=[],"undefined"!=typeof a&&"undefined"!=typeof a.children&&this.addChild(a.children)}return __extends(c,b),c.prototype.addChild=function(a){var b=arguments;a instanceof Array&&(b=a);for(var c=b.length,d=0;c>d;d++){var e=b[d];this._children.push(e),e._container=this}this.calculateDimensions()},c.prototype.removeChild=function(a){var b=arguments;a instanceof Array&&(b=a);for(var c=b.length,d=0;c>d;d++){var e=b[d],f=this._children.indexOf(e);f>=0&&this._children.splice(f,1),e.container=null}},c.prototype.draw=function(a){a.save(),a.globalAlpha*=this.opacity,a.translate(this.x,this.y),a.rotate(this.rotation);for(var b,c=this._children.length,d=0;c>d;d++)b=this._children[d],b.visible&&b.drawElement(a);a.restore()},c.prototype.drawElement=function(a){this.draw(a)},c.prototype.intersect=function(a,b,c){for(var d=!1,e=this._children.length-1;e>=0;e--){var f=this._children[e];f.intersect(a,b,c)&&(d=!0)}return d===!0&&this.dispatchEvent(c.type,{event:c}),d},c.prototype.calculateDimensions=function(){0===this._children.length&&(this.width=this.height=0);for(var a=this._children[0],b=a.x,c=a.x+a.width,d=a.y,e=a.y+a.height,f=this._children.length,g=1;f>g;g++){var h=this._children[g];h.x<b?b=h.x:h.x+h.width>c&&(c=h.x+h.width),h.y<d?d=h.y:h.y+h.height>e&&(e=h.y+h.height)}this.width=c-b,this.height=e-d},c.prototype.logic=function(a){for(var b=this._children.length-1;b>=0;b--){var c=this._children[b];c._has_logic===!0&&c.logic(a)}},c.prototype.clone=function(){for(var b=[],c=this._children.length,d=0;c>d;d++)b.push(this._children[d].clone());return new a.Container({x:this.x,y:this.y,children:b})},c}(a.Element);a.Container=b}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(a){b.call(this,a),this._has_logic=!0,this.movement_speed=a.movement_speed,"number"==typeof a.angleOrTarget?(this._move_x=Math.cos(a.angleOrTarget)*a.movement_speed,this._move_y=Math.sin(a.angleOrTarget)*a.movement_speed,this.rotation=a.angleOrTarget,this.logic=this.fixedLogic):(this._target=a.angleOrTarget,this.logic=this.targetLogic),this._remove="undefined"==typeof a.remove?this.remove:a.remove,c._container.addChild(this),c._all.push(this)}return __extends(c,b),c.init=function(){c._all=[],c._container=new a.Container,c._container._has_logic=!0,a.getCanvas().addElement(c._container)},c.prototype.remove=function(){b.prototype.remove.call(this);var a=c._all.indexOf(this);c._all.splice(a,1),c._container.removeChild(this)},c.prototype.fixedLogic=function(b){this.x+=this._move_x*b,this.y+=this._move_y*b,a.getCanvas().isInCanvas(this.x,this.y)||this._remove()},c.prototype.targetLogic=function(a){var b=this._target,c=Utilities.calculateAngle(this.x,-1*this.y,b.x,-1*b.y);this.x+=Math.cos(c)*this.movement_speed*a,this.y+=Math.sin(c)*this.movement_speed*a,this.rotation=c,Utilities.boxBoxCollision(this.x-this.width/2,this.y-this.height/2,this.width,this.height,b.x-b.width/2,b.y-b.height/2,b.width,b.height)&&this._remove()},c.prototype.logic=function(){},c.prototype.clone=function(){for(var b=[],c=this._children.length,d=0;c>d;d++)b.push(this._children[d].clone());var e;return e=this._target?this._target:this.rotation,new a.Bullet({x:this.x,y:this.y,children:b,movement_speed:this.movement_speed,angleOrTarget:e,remove:this._remove})},c}(a.Container);a.Bullet=b}(Game||(Game={}));var Game;!function(a){var b=function(){function a(a){this._canvas=document.createElement("canvas"),this._canvas.className="Game-Canvas",this._ctx=this._canvas.getContext("2d"),this._canvas.width=this._width=a.width,this._canvas.height=this._height=a.height,this._elements=[],this.events_enabled=!0,this.update_on_loop=!0}return a.prototype.addElement=function(a){var b=arguments;a instanceof Array&&(b=a);for(var c=b.length,d=0;c>d;d++)this._elements.push(b[d])},a.prototype.removeElement=function(a){var b=arguments,c=!1;a instanceof Array&&(b=a);for(var d=b.length,e=0;d>e;e++){var f=b[e],g=this._elements.indexOf(f);g>=0&&(this._elements.splice(g,1),c=!0)}return c},a.prototype.logic=function(a){for(var b=this._elements.length-1;b>=0;b--){var c=this._elements[b];c._has_logic===!0&&c.logic(a)}},a.prototype.draw=function(){this._ctx.clearRect(0,0,this._width,this._height);for(var a=this._elements.length,b=0;a>b;b++){var c=this._elements[b];c.visible&&c.draw(this._ctx)}},a.prototype.mouseEvents=function(a){for(var b=this._elements,c=this._canvas.getBoundingClientRect(),d=a.x-c.left,e=a.y-c.top,f=a.type,g=b.length-1;g>=0;g--){var h=b[g];if(h.hasListeners(f)&&h.intersect(d,e,a))break}},a.prototype.updateDimensions=function(a,b){this._canvas.width=this._width=a,this._canvas.height=this._height=b},a.prototype.getRandomPosition=function(){return{x:Utilities.getRandomInt(0,this._width),y:Utilities.getRandomInt(0,this._height)}},a.prototype.isInCanvas=function(a,b){return 0>a||a>this._width||0>b||b>this._height?!1:!0},a.prototype.getWidth=function(){return this._width},a.prototype.getHeight=function(){return this._height},a.prototype.getHtmlCanvasElement=function(){return this._canvas},a.prototype.getCanvasContext=function(){return this._ctx},a.prototype.getElements=function(){return this._elements},a}();a.Canvas=b}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(a){b.call(this,a),this._radius=a.radius,this.width=this.height=2*a.radius,this.color=a.color}return __extends(c,b),Object.defineProperty(c.prototype,"radius",{get:function(){return this._radius},set:function(a){this._radius=a,this.width=this.height=2*a},enumerable:!0,configurable:!0}),c.prototype.drawElement=function(a){a.save(),a.beginPath(),a.globalAlpha*=this.opacity,a.fillStyle=this.color,a.translate(this.x,this.y),a.rotate(this.rotation),a.arc(0,0,this._radius,0,2*Math.PI),a.fill(),a.restore()},c.prototype.intersect=function(a,b,c){var d=0,e=0;return null!==this._container&&(d=this._container.x,e=this._container.y),Utilities.circlePointCollision(d+this.x,e+this.y,this._radius,a,b)?(this.dispatchEvent(c.type,{event:c}),!0):!1},c.prototype.clone=function(){return new a.Circle({x:this.x,y:this.y,radius:this._radius,color:this.color})},c}(a.Element);a.Circle=b}(Game||(Game={}));var Game;!function(a){var b;!function(a){var b=function(){function a(a){var b=document.createElement("div");if(b.className="Game-Element","undefined"!=typeof a){if("undefined"!=typeof a.cssId&&(b.id=a.cssId),"undefined"!=typeof a.cssClass)if("string"==typeof a.cssClass)b.classList.add(a.cssClass);else for(var c=a.cssClass.length-1;c>=0;c--)b.classList.add(a.cssClass[c]);if("undefined"!=typeof a.preText){var d=document.createElement("span");d.innerHTML=a.preText,b.appendChild(d)}}this.container=b,this.isActive=!0}return a.prototype.setActive=function(a){a!==this.isActive&&(a===!0?(this.addEvents(),this.container.classList.remove("Game-inactive")):(this.removeEvents(),this.container.classList.add("Game-inactive")),this.isActive=a)},a.prototype.addEvents=function(){},a.prototype.removeEvents=function(){},a.prototype.clear=function(){},a}();a.HtmlElement=b;var c=function(a){function b(b){a.call(this,b),this.container.classList.add("Game-Container"),this._children=[],"undefined"!=typeof b&&"undefined"!=typeof b.children&&this.addChild(b.children)}return __extends(b,a),b.prototype.addChild=function(a){var b=arguments;a instanceof Array&&(b=a);for(var c=b.length,d=0;c>d;d++){var e=b[d];this._children.push(e),this.container.appendChild(e.container)}},b.prototype.removeChild=function(a){var b=arguments;a instanceof Array&&(b=a);for(var c=b.length,d=0;c>d;d++){var e=b[d],f=this._children.indexOf(e);f>=0&&(this._children.splice(f,1),e.clear())}},b.prototype.clear=function(){for(var a=this._children.length-1;a>=0;a--)this._children[a].clear();this.container.parentNode.removeChild(this.container),this._children.length=0},b}(b);a.HtmlContainer=c;var d=function(a){function b(b){a.call(this,b),this.element=document.createElement("span"),this.container.appendChild(this.element),this.container.classList.add("Game-Value"),this.setValue(b.value)}return __extends(b,a),b.prototype.setValue=function(a){a!==this.value&&(this.value=a,this.element.innerHTML=a)},b.prototype.getValue=function(){return this.value},b.prototype.clear=function(){this.value=null},b}(b);a.Value=d;var e=function(a){function b(b){var c=this;"undefined"==typeof this.click_ref&&(this.click_ref=function(){b.callback(c)}),a.call(this,b),this.container.classList.add("Game-Button"),this.addEvents()}return __extends(b,a),b.prototype.addEvents=function(){this.container.addEventListener("click",this.click_ref)},b.prototype.removeEvents=function(){this.container.removeEventListener("click",this.click_ref)},b.prototype.clear=function(){a.prototype.clear.call(this),this.removeEvents(),this.click_ref=null},b}(d);a.Button=e;var f=function(a){function b(b){var c=this;this.click_ref=function(){c.setValue(!c.value),b.callback(c)},a.call(this,b),this.element=document.createElement("span"),this.container.appendChild(this.element),this.container.classList.add("Game-Boolean"),this.setValue(b.value),this.addEvents()}return __extends(b,a),b.prototype.addEvents=function(){this.container.addEventListener("click",this.click_ref)},b.prototype.removeEvents=function(){this.container.removeEventListener("click",this.click_ref)},b.prototype.setValue=function(a){a!==this.value&&(this.element.innerHTML=a===!0?"On":"Off",this.value=a)},b.prototype.getValue=function(){return this.value},b.prototype.clear=function(){this.removeEvents(),this.click_ref=null},b}(b);a.Boolean=f;var g=function(a){function b(b){var c=this;this.isValue1=!0,this.click_ref=function(){c.isValue1?(c.element.innerHTML=b.value2,b.callback(c)):(c.element.innerHTML=b.value,b.callback2(c)),c.isValue1=!c.isValue1},a.call(this,b),this.container.classList.add("Game-TwoState")}return __extends(b,a),b}(e);a.TwoState=g;var h=function(a){function b(b){var c=this;this.click_ref=function(){var a=this;if(a!==c.selected){var d=c.elements.indexOf(a);c.select(d),b.callback(c,d,a)}},a.call(this,b),this.elements=[];for(var d=b.options.length,e=0;d>e;e++){var f=document.createElement("span");f.innerHTML=b.options[e],this.container.appendChild(f),this.elements.push(f)}this.container.classList.add("Game-MultipleOptions"),this.selected=null,this.select(0),this.addEvents()}return __extends(b,a),b.prototype.select=function(a){var b=this.elements[a];b&&b!==this.selected&&(this.selected&&this.selected.classList.remove("Game-selected"),this.selected=b,b.classList.add("Game-selected"))},b.prototype.addEvents=function(){for(var a=this.elements.length-1;a>=0;a--)this.elements[a].addEventListener("click",this.click_ref)},b.prototype.removeEvents=function(){for(var a=this.elements.length-1;a>=0;a--)this.elements[a].removeEventListener("click",this.click_ref)},b.prototype.clear=function(){this.removeEvents(),this.click_ref=null,this.elements.length=0},b}(b);a.MultipleOptions=h;var i=function(a){function b(b){var c=this;"undefined"==typeof b.step&&(b.step=1),this.change_ref=function(a){c.setValue(parseInt(a.target.value,10)),b.onChange&&b.onChange(c)},this.input_ref=function(a){c.value.innerHTML=a.target.value},a.call(this,b),this.input=document.createElement("input"),this.input.type="range",this.input.min=b.min.toString(),this.input.max=b.max.toString(),this.input.value=b.value.toString(),this.input.step=b.step.toString(),this.value=document.createElement("span"),this.container.classList.add("Game-Range"),this.container.appendChild(this.input),this.container.appendChild(this.value),this.setValue(b.value),this.addEvents()}return __extends(b,a),b.prototype.setValue=function(a){if(a!==this.current_value){var b=a.toString();this.current_value=a,this.input.value=b,this.value.innerHTML=b}},b.prototype.getValue=function(){return this.current_value},b.prototype.addEvents=function(){this.input.addEventListener("input",this.input_ref),this.input.addEventListener("change",this.change_ref)},b.prototype.removeEvents=function(){this.input.removeEventListener("input",this.input_ref),this.input.removeEventListener("change",this.change_ref)},b.prototype.clear=function(){this.removeEvents(),this.change_ref=null,this.input_ref=null},b}(b);a.Range=i}(b=a.Html||(a.Html={}))}(Game||(Game={}));var Game;!function(a){var b;!function(a){function b(a,b,c){h=a,i=b,j=c===!0?function(a,b){return a-b}:function(a,b){return b-a},g()}function c(a,b){"undefined"==typeof k[a]&&(k[a]=[]),k[a].indexOf(b)>=0||(k[a].push(b),k[a].sort(j),k[a].length>h&&k[a].pop(),f())}function d(a){return k[a]}function e(){k={},localStorage.removeItem(i)}function f(){Utilities.saveObject(i,k)}function g(){var a=Utilities.getObject(i);a&&(k=a)}var h,i,j,k={};a.init=b,a.add=c,a.get=d,a.clear=e}(b=a.HighScore||(a.HighScore={}))}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(c){if(b.call(this,c),this.text=document.createElement("div"),this.text.className="Game-Message-text",this.setText(c.text),this.container.appendChild(this.text),this.container.classList.add("Game-Message-container"),this.timeout=null,this.background=null,"undefined"!=typeof c.buttons){var d;d=c.buttons instanceof Array?c.buttons:[c.buttons];for(var e=d.length,f=new a.Html.HtmlContainer({cssClass:"Game-Message-Components"}),g=0;e>g;g++)f.addChild(d[g]);this.addChild(f)}if(Utilities.isNumber(c.timeout)){this.timeout=new Utilities.Timeout;var h=this;this.timeout.start(function(){h.clear()},1e3*c.timeout)}c.background===!0&&(this.background=document.createElement("div"),this.background.className="Game-Message-background",c.container.appendChild(this.background)),c.container.appendChild(this.container)}return __extends(c,b),c.prototype.clear=function(){this.timeout&&(this.timeout.clear(),this.timeout=null),this.background&&this.container.parentNode.removeChild(this.background),b.prototype.clear.call(this)},c.prototype.getText=function(){return this.text.innerHTML},c.prototype.setText=function(a){a instanceof HTMLElement?(this.text.innerHTML="",this.text.appendChild(a)):this.text.innerHTML=a},c}(a.Html.HtmlContainer);a.Message=b}(Game||(Game={}));var Game;!function(a){!function(a){a[a.properties=0]="properties",a[a.wait=1]="wait",a[a.call=2]="call"}(a.TweenAction||(a.TweenAction={}));var b=(a.TweenAction,function(){function b(a){this._element=a,this._steps=[],this._current_step=null,this._start_properties=null,this._count=0,this._update=null}return b.prototype.start=function(){this.nextStep(),b._tweens.push(this)},b.prototype.to=function(b,c,d){return"undefined"==typeof d&&(d=a.Tween.Ease.linear),this._steps.push({action:0,end_properties:b,duration:c,ease:d}),this},b.prototype.wait=function(a){return this._steps.push({action:1,duration:a}),this},b.prototype.call=function(a){return this._steps.push({action:2,callback:a}),this},b.prototype.remove=function(){var a=b._tweens.indexOf(this);b._tweens.splice(a,1)},b.prototype.nextStep=function(){var a=this._steps.shift();if(!a)return void this.remove();if(this._current_step=a,2===a.action)a.callback(),this.nextStep();else if(1===a.action)this._count=0,this._update=this.waitUpdate;else if(0===a.action){var b={};for(var c in a.end_properties)b[c]=this._element[c];this._start_properties=b,this._count=0,this._update=this.propertiesUpdate}},b.prototype.waitUpdate=function(a){var b=this._current_step;this._count+=a,this._count>=b.duration&&this.nextStep()},b.prototype.propertiesUpdate=function(a){var b=this._current_step;this._count+=a;var c=this._count/b.duration,d=b.ease(c);for(var e in b.end_properties){var f=this._start_properties[e],g=b.end_properties[e];this._element[e]=f+(g-f)*d}if(this._count>=b.duration){for(var e in b.end_properties)this._element[e]=b.end_properties[e];this.nextStep()}},b.getTween=function(a){for(var c=b._tweens.length-1;c>=0;c--){var d=b._tweens[c];if(d._element===a)return d}return null},b.removeTweens=function(a){for(var c=b._tweens.length-1;c>=0;c--){var d=b._tweens[c];d._element===a&&b._tweens.splice(c,1)}},b.removeAll=function(){b._tweens.length=0},b.update=function(a){for(var c=b._tweens.length-1;c>=0;c--)b._tweens[c]._update(a)},b._tweens=[],b}());a.Tween=b;var b;!function(a){var b;!function(a){function b(a){return a}function c(a){return a*a}a.linear=b,a.quadraticIn=c}(b=a.Ease||(a.Ease={}))}(b=a.Tween||(a.Tween={}))}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(c){b.call(this,c),this._grid=[];for(var d=0;d<c.columns;d++){this._grid[d]=[];for(var e=0;e<c.lines;e++)this._grid[d][e]=null}if("undefined"==typeof c.refX&&(c.refX=c.squareSize/2),"undefined"==typeof c.refY&&(c.refY=c.squareSize/2),"undefined"!=typeof c.background){var f=c.squareSize*c.columns,g=c.squareSize*c.lines;this._background=new a.Rectangle({x:c.refX+f/2-c.squareSize/2,y:c.refY+g/2-c.squareSize/2,width:f,height:g,color:c.background.color,fill:c.background.fill}),"undefined"==typeof c.background.canvasId&&(c.background.canvasId=0),a.getCanvas(c.background.canvasId).addElement(this._background)}else this._background=null;this.square_size=c.squareSize,this.columns=c.columns,this.lines=c.lines,this.ref_x=c.refX,this.ref_y=c.refY}return __extends(c,b),c.prototype.toCanvas=function(a,b){return{x:this.ref_x+a*this.square_size,y:this.ref_y+b*this.square_size}},c.prototype.toGrid=function(a,b){return{column:Math.round((a-this.ref_x)/this.square_size),line:Math.round((b-this.ref_y)/this.square_size)}},c.prototype.addElement=function(a,b,c){0>b?b=0:b>=this.columns&&(b=this.columns-1),0>c?c=0:c>=this.lines&&(c=this.lines-1);var d=this._grid[b][c];this._grid[b][c]=a;var e=this.toCanvas(b,c);return a.x=e.x,a.y=e.y,a.column=b,a.line=c,null!==d&&this.dispatchEvent("collision",{element:a,collidedWith:d}),d},c.prototype.moveElement=function(a,b,c,d){return this.movePosition(a.column,a.line,b,c,d)},c.prototype.movePosition=function(b,c,d,e,f){var g=this._grid[b][c],h=this._grid[d][e];if(null===g||g===h)return null;this._grid[d][e]=g,this._grid[b][c]=null;var i=this.toCanvas(d,e);if(g.column=d,g.line=e,"undefined"==typeof f||0>=f)g.x=i.x,g.y=i.y;else{var j=new a.Tween(g);j.to({x:i.x,y:i.y},f),j.start()}return null!==h&&(h.column=-1,h.line=-1,this.dispatchEvent("collision",{element:g,collidedWith:h})),h},c.prototype.removeElement=function(a){return this.removePosition(a.column,a.line)},c.prototype.removePosition=function(a,b){if(!this.isInGrid(a,b))return null;var c=this._grid[a][b];return this._grid[a][b]=null,null!==c&&(c.column=-1,c.line=-1),c},c.prototype.getElement=function(a,b){if(!this.isInGrid(a,b))return null;var c=this._grid[a][b];return c?c:null},c.prototype.getElement2=function(a,b){var c=this.toGrid(a,b);return this.getElement(c.column,c.line)},c.prototype.isEmpty=function(a,b){return this._grid[a][b]?!1:!0},c.prototype.normalizePosition=function(a,b){return 0>a?a=0:a>=this.columns&&(a=this.columns-1),0>b?b=0:b>=this.lines&&(b=this.lines-1),{column:a,line:b}},c.prototype.isInGrid=function(a,b){return 0>a||a>=this.columns||0>b||b>=this.lines?!1:!0},c.prototype.getRandomPosition=function(){return{column:Utilities.getRandomInt(0,this.columns-1),line:Utilities.getRandomInt(0,this.lines-1)}},c.prototype.getRandomEmptyPosition=function(){var a=this.getEmptyPositions();if(a.length>0){var b=Utilities.getRandomInt(0,a.length-1);return a[b]}return null},c.prototype.getEmptyPositions=function(){for(var a=[],b=0;b<this.columns;b++)for(var c=0;c<this.lines;c++)null===this._grid[b][c]&&a.push({column:b,line:c});return a},c.prototype.getDimensions=function(){return{x:this.ref_x,y:this.ref_y,width:this.square_size*this.columns,height:this.square_size*this.lines}},c.prototype.clear=function(){null!==this._background&&this._background.remove()},c.prototype.getNeighbors=function(a,b,c){"undefined"==typeof c&&(c=1);for(var d,e=[],f=this.normalizePosition(a-c,b-c),g=this.normalizePosition(a+c,b+c),h=f.column;h<=g.column;h++)for(var i=f.line;i<=g.line;i++)(h!==a||i!==b)&&(d=this.getElement(h,i),null!==d&&e.push(d));return e},c}(a.EventDispatcher);a.Grid=b}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(a){b.call(this,a),this.width=a.frameWidth,this.height=a.frameHeight,this._half_width=a.frameWidth/2,this._half_height=a.frameHeight/2,this._frames_per_line=Math.floor(a.image.width/a.frameWidth),this._current_animation_position=0,this._count_interval=0,this.setFrame(0),"undefined"==typeof a.animations?(this._animations={},this.interval=1):(this._animations=a.animations,this.interval=a.interval)}return __extends(c,b),c.prototype.setFrame=function(a){var b=Math.floor(a/this._frames_per_line),c=a-b*this._frames_per_line;this._source_x=c*this.width,this._source_y=b*this.height},c.prototype.play=function(a){return this._current_animation=this._animations[a],this._current_animation?(this._has_logic=!0,this._current_animation_position=0,this.setFrame(this._current_animation[this._current_animation_position]),!0):!1},c.prototype.nextFrame=function(){this._current_animation_position++,this._current_animation_position>=this._current_animation.length&&(this._current_animation_position=0),this.setFrame(this._current_animation[this._current_animation_position])},c.prototype.logic=function(a){this._count_interval+=a,this._count_interval>=this.interval&&(this._count_interval=0,this.nextFrame())},c.prototype.clone=function(){return new a.Sprite({x:this.x,y:this.y,image:this.image,frameWidth:this.width,frameHeight:this.height,animations:this._animations,interval:this.interval})},c}(a.Bitmap);a.Sprite=b}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(a){var c=this;if("undefined"==typeof a.text&&(a.text=""),"undefined"==typeof a.fontFamily&&(a.fontFamily="monospace"),"undefined"==typeof a.fontSize&&(a.fontSize=20),"undefined"==typeof a.textAlign&&(a.textAlign="start"),"undefined"==typeof a.textBaseline&&(a.textBaseline="top"),"undefined"==typeof a.fill&&(a.fill=!0),b.call(this,a),this._font_size=a.fontSize,this.text=a.text,this.font_family=a.fontFamily,this.textAlign=a.textAlign,this.textBaseline=a.textBaseline,this.fill=a.fill,this._timeout=a.timeout,Utilities.isNumber(a.timeout)&&a.timeout>0){var d=new Utilities.Timeout;d.start(function(){c.remove()},1e3*a.timeout)}}return __extends(c,b),c.prototype.drawElement=function(a){a.save(),a.globalAlpha*=this.opacity,a.font=this._font,a.textAlign=this.textAlign,a.textBaseline=this.textBaseline;for(var b=this._lines.length,c=0;b>c;c++){var d=this.y+c*this.font_size;this.fill?a.fillText(this._lines[c],this.x,d):a.strokeText(this._lines[c],this.x,d)}a.restore()},Object.defineProperty(c.prototype,"text",{get:function(){return this._text},set:function(b){this._text=b,this._lines=this._text.split("\n");for(var c,d=a.getCanvas().getCanvasContext(),e=this._lines[0],f=d.measureText(e).width,g=this._lines.length,h=1;g>h;h++)e=this._lines[h],c=d.measureText(e).width,c>f&&(f=c);this.width=f,this.height=this.font_size*g},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"font_family",{get:function(){return this._font_family},set:function(a){this._font_family=a,this._font=this._font_size+"px "+a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"font_size",{get:function(){return this._font_size},set:function(a){this._font_size=a,this._font=a+"px "+this._font_family},enumerable:!0,configurable:!0}),c.prototype.clone=function(){return new a.Text({x:this.x,y:this.y,text:this._text,fontFamily:this._font_family,fontSize:this._font_size,timeout:this._timeout,textAlign:this.textAlign,textBaseline:this.textBaseline,fill:this.fill})},c}(a.Element);a.Text=b}(Game||(Game={}));var Game;!function(a){var b;!function(a){function b(){try{e=new AudioContext}catch(a){e=null}}function c(a,b){if(!e)throw Error("AudioContext not supported in this browser.");e.decodeAudioData(a,b)}function d(a){if(!e)throw Error("AudioContext not supported in this browser.");var b=e.createBufferSource();b.buffer=a,b.connect(e.destination),b.start()}var e;a.init=b,a.decodeAudio=c,a.play=d}(b=a.Sound||(a.Sound={}))}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(a){b.call(this,a);var c=!1;"undefined"!=typeof a&&Utilities.isBoolean(a.save_global)&&(c=a.save_global),this._total_items=0,this._loaded_items=0,this.save_global=c,this._data={}}return __extends(c,b),c.prototype._loaded=function(b,c){this.save_global?a.Preload.DATA[b]=c:this._data[b]=c,this.dispatchEvent("fileload",{id:b,data:c}),this._loaded_items++,this._loaded_items>=this._total_items&&this.dispatchEvent("complete")},c.prototype._on_error=function(a,b){this.dispatchEvent("error",{event:a,id:b})},c.prototype._on_abort=function(a,b){this.dispatchEvent("abort",{event:a,id:b})},c.prototype._on_progress=function(a){var b=0;a.lengthComputable&&(b=a.loaded/a.total);var c=Math.round((b+this._loaded_items)/this._total_items*100);this.dispatchEvent("progress",c)},c.prototype.load=function(b,c,d){var e;if(e="undefined"==typeof e?a.Preload.getType(c):a.Preload.TYPES[d],!e)throw new Error("Invalid file type.");var f=this;this._total_items++;var g=new XMLHttpRequest;g.open("get",c,!0),g.responseType=a.Preload.RESPONSE_TYPE[e],g.addEventListener("error",function(a){f._on_error(a,b)}),g.addEventListener("abort",function(a){f._on_abort(a,b)}),g.addEventListener("progress",function(a){f._on_progress(a)}),g.addEventListener("load",function(){var d=this.response;if("image"===e){var g=new Image;g.src=window.URL.createObjectURL(d),g.onload=function(){f._loaded(b,g)}}else"json"===e?f._loaded(b,d):"audio"===e?a.Sound.decodeAudio(d,function(a){return a?void f._loaded(b,a):void console.log("Error decoding audio file:",b,c)}):f._loaded(b,d)},!1),g.send()},c.prototype.loadManifest=function(a,b){var c=a.length;"undefined"==typeof b&&(b="");for(var d=0;c>d;d++){var e=a[d];this.load(e.id,b+e.path)}},c.prototype.get=function(a){return this._data[a]},c}(a.EventDispatcher);a.Preload=b;var b;!function(a){function b(b){return a.DATA[b]}function c(b){var c=b.split(".").pop();for(var d in a.EXTENSIONS)if(a.EXTENSIONS.hasOwnProperty(d)&&a.EXTENSIONS[d].indexOf(c)>=0)return d;return null}!function(a){a[a.image=0]="image",a[a.json=1]="json",a[a.text=2]="text",a[a.audio=3]="audio"}(a.TYPES||(a.TYPES={}));a.TYPES;a.EXTENSIONS={image:["png","jpg","jpeg"],json:["json"],text:["txt"],audio:["ogg","mp3"]},a.RESPONSE_TYPE={image:"blob",json:"json",text:"text",audio:"arraybuffer"},a.DATA={},a.get=b,a.getType=c}(b=a.Preload||(a.Preload={}))}(Game||(Game={}));var Game;!function(a){var b=function(b){function c(a){b.call(this,a),"undefined"==typeof a.fill&&(a.fill=!0),this.fill=a.fill,this.width=a.width,this.height=a.height,this.half_width=a.width/2,this.half_height=a.height/2,this.color=a.color}return __extends(c,b),c.prototype.drawElement=function(a){a.save(),a.beginPath(),a.globalAlpha*=this.opacity,a.translate(this.x,this.y),a.rotate(this.rotation),this.fill?(a.fillStyle=this.color,a.fillRect(-this.half_width,-this.half_height,this.width,this.height)):(a.strokeStyle=this.color,a.strokeRect(-this.half_width,-this.half_height,this.width,this.height)),a.restore()},c.prototype.intersect=function(a,b,c){var d=0,e=0;return null!==this._container&&(d=this._container.x,e=this._container.y),Utilities.pointBoxCollision(a,b,d+this.x-this.half_width,e+this.y-this.half_height,this.width,this.height)?(this.dispatchEvent(c.type,{event:c}),!0):!1},c.prototype.clone=function(){return new a.Rectangle({x:this.x,y:this.y,width:this.width,height:this.height,color:this.color,fill:this.fill})},c}(a.Element);a.Rectangle=b}(Game||(Game={}));var Game;!function(a){function b(b,e,f){p=document.createElement("div"),p.id="Game-canvasContainer",b.appendChild(p);var g=new a.Canvas({width:e,height:f});a.addCanvas(g),a.Sound.init(),a.Bullet.init(),p.addEventListener("click",l),document.addEventListener("visibilitychange",function(){document.hidden?d():c()}),c()}function c(){q=(new Date).getTime(),m()}function d(){window.cancelAnimationFrame(r)}function e(a){return"undefined"==typeof a&&(a=0),s[a]}function f(a,b){Utilities.isNumber(b)?0>b?b=0:b>s.length&&(b=s.length):b=s.length;var c=s[b];return s.splice(b,0,a),c?p.insertBefore(a._canvas,c._canvas):p.appendChild(a._canvas),b}function g(a,b){return"undefined"==typeof b&&(b=0),s[b].addElement(a)}function h(a){for(var b=s.length-1;b>=0;b--){var c=s[b],d=c.removeElement(a);if(d)return!0}return!1}function i(a,b){return Utilities.isFunction(a)?((!Utilities.isNumber(b)||0>=b)&&(b=-1),t.push({callback:a,interval:b,count:0}),!0):!1}function j(a){for(var b=t.length-1;b>=0;b--){var c=t[b];if(c.callback===a)return t.splice(b,1),!0}return!1}function k(){t.length=0}function l(a){for(var b=s.length-1;b>=0;b--){var c=s[b];c.events_enabled&&c.mouseEvents(a)}}function m(){var b=(new Date).getTime(),c=(b-q)/1e3;q=b,n(c),a.Tween.update(c);for(var d=s.length-1;d>=0;d--){var e=s[d];e.update_on_loop&&(e.logic(c),e.draw())}r=window.requestAnimationFrame(m)}function n(a){for(var b=t.length-1;b>=0;b--){var c=t[b];c.interval<=0?c.callback():(c.count+=a,c.count>=c.interval&&(c.count=0,c.callback()));

}}function o(){return p}var p,q,r,s=[],t=[];a.init=b,a.startGameLoop=c,a.stopGameLoop=d,a.getCanvas=e,a.addCanvas=f,a.addElement=g,a.removeElement=h,a.addToGameLoop=i,a.removeFromGameLoop=j,a.removeAllCallbacks=k,a.getCanvasContainer=o}(Game||(Game={}));var Game;!function(a){!function(a){a[a.stop=0]="stop",a[a.angle=1]="angle",a[a.destination=2]="destination",a[a.loop=3]="loop"}(a.UnitMovement||(a.UnitMovement={}));var b=(a.UnitMovement,function(b){function c(a){b.call(this,a),"undefined"==typeof a.movement_speed&&(a.movement_speed=50),"undefined"==typeof a.health&&(a.health=1),"undefined"==typeof a.bullet_movement_speed&&(a.bullet_movement_speed=100),"undefined"==typeof a.bullet_shape&&(a.bullet_shape=null),this._has_logic=!0,this.movement_speed=a.movement_speed,this.bullet_movement_speed=a.bullet_movement_speed,this.health=a.health,this._movement_type=0,this._is_moving=!1,this._move_x=0,this._move_y=0,this._move_callback=null,this._destination_x=0,this._destination_y=0,this._path=[],this._loop_path_position=0,this._is_destination_x_diff_positive=!1,this._is_destination_y_diff_positive=!1,this._bullet_interval=-1,this._bullet_interval_count=0,this._angle_or_target=null,this._bullets=[],this._bullet_shape=a.bullet_shape;var c=this.constructor;"undefined"==typeof c._all&&(c._all=[]),"undefined"==typeof c.collidesWith&&(c.collidesWith=[]),c._all.push(this)}return __extends(c,b),c.prototype.remove=function(b){if("undefined"==typeof b)this._removeNow();else{var c=new a.Tween(this),d=this;c.to({opacity:0},b).call(function(){d._removeNow()}),c.start()}},c.prototype._removeNow=function(){b.prototype.remove.call(this);var a=this.constructor,c=a._all,d=c.indexOf(this);c.splice(d,1)},c.prototype.moveTo=function(a,b,c){Utilities.isFunction(c)||(c=null),this._movement_type=2,this._path.length=0,this._path.push({x:a,y:b,callback:c}),this.movementLogic=this.movementPathLogic,this.moveToNext()},c.prototype.moveToNext=function(){var a;if(3===this._movement_type?(this._loop_path_position++,this._loop_path_position>=this._path.length&&(this._loop_path_position=0),a=this._path[this._loop_path_position]):a=this._path.shift(),a){var b=a.x,c=a.y;this._is_moving=!0,this._destination_x=b,this._destination_y=c,this._move_callback=a.callback,this._is_destination_x_diff_positive=b-this.x>0,this._is_destination_y_diff_positive=c-this.y>0;var d=Utilities.calculateAngle(this.x,-1*this.y,b,-1*c);return this._move_x=Math.cos(d)*this.movement_speed,this._move_y=Math.sin(d)*this.movement_speed,!0}return this._is_moving=!1,!1},c.prototype.stop=function(){this._movement_type=0,this._path.length=0,this._is_moving=!1},c.prototype.queueMoveTo=function(a,b,c){Utilities.isFunction(c)||(c=null),this._path.push({x:a,y:b,callback:c})},c.prototype.moveLoop=function(a){this._movement_type=3,this._path=a,this._loop_path_position=-1,this.movementLogic=this.movementPathLogic,this.moveToNext()},c.prototype.moveAngle=function(a,b,c){b===!0&&(a=Math.PI/180*a),this._movement_type=1,this._is_moving=!0,this._move_x=Math.cos(a)*this.movement_speed,this._move_y=Math.sin(a)*this.movement_speed,this.rotation=a,this._move_callback=c,this.movementLogic=this.movementAngleLogic},c.prototype.fireBullet=function(a,b){"undefined"==typeof a&&(a=this.rotation),Utilities.isNumber(b)&&b>0&&(this._bullet_interval=b,this._bullet_interval_count=0,this._angle_or_target=a),this._fire(a)},c.prototype.stopFiring=function(){this._bullet_interval=-1,this._bullet_interval_count=0,this._angle_or_target=null},c.prototype._fire=function(b){var c=this;if("undefined"==typeof b&&(b=this._angle_or_target),"number"!=typeof b&&b._removed===!0)return void this.stopFiring();var d;d=null!==this._bullet_shape?new this._bullet_shape.classRef(this._bullet_shape.args):new a.Rectangle({width:10,height:2,color:"blue"});var e=new a.Bullet({x:this.x,y:this.y,angleOrTarget:b,movement_speed:this.bullet_movement_speed,remove:function(){var a=c._bullets.indexOf(e);c._bullets.splice(a,1),e.remove()}});e.addChild(d),this._bullets.push(e)},c.prototype.movementLogic=function(){},c.prototype.movementAngleLogic=function(b){this._is_moving&&(this.x+=this._move_x*b,this.y+=this._move_y*b,a.getCanvas().isInCanvas(this.x,this.y)||this._move_callback&&this._move_callback())},c.prototype.movementPathLogic=function(a){if(this._is_moving){this.x+=this._move_x*a,this.y+=this._move_y*a;var b=this._destination_x-this.x,c=this._destination_y-this.y;this._is_destination_x_diff_positive&&(b*=-1),this._is_destination_y_diff_positive&&(c*=-1),b>=0&&c>=0&&(this.x=this._destination_x,this.y=this._destination_y,this._move_callback&&this._move_callback(),this.moveToNext())}},c.prototype.firingLogic=function(a){this._bullet_interval>0&&(this._bullet_interval_count+=a,this._bullet_interval_count>=this._bullet_interval&&(this._fire(),this._bullet_interval_count=0))},c.prototype.collisionLogic=function(){var a=this.constructor,b=a.collidesWith.length;if(b>0&&this.hasListeners("collision"))for(var c=this.x-this.width/2,d=this.y-this.height/2,e=this.width,f=this.height,g=0;b>g;g++)for(var h=a.collidesWith[g]._all,i=h.length-1;i>=0;i--){var j=h[i];if(j!==this){var k=j.width,l=j.height,m=j.x-k/2,n=j.y-l/2;if(Utilities.boxBoxCollision(c,d,e,f,m,n,k,l))return void this.dispatchEvent("collision",{element:this,collidedWith:j});for(var o=this._bullets.length-1;o>=0;o--){var p=this._bullets[o];if(Utilities.boxBoxCollision(p.x-p.width/2,p.y-p.height/2,p.width,p.height,m,n,k,l))return void this.dispatchEvent("collision",{element:this,collidedWith:j})}}}},c.prototype.logic=function(a){this.movementLogic(a),this.firingLogic(a),this.collisionLogic(a)},c.prototype.clone=function(){for(var b=[],c=this._children.length,d=0;c>d;d++)b.push(this._children[d].clone());return new a.Unit({x:this.x,y:this.y,children:b,movement_speed:this.movement_speed,bullet_movement_speed:this.bullet_movement_speed,health:this.health,bullet_shape:this._bullet_shape})},c}(a.Container));a.Unit=b}(Game||(Game={}));